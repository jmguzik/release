apiVersion: v1
kind: List
items:
- apiVersion: v1
  kind: ConfigMap
  metadata:
    name: quayio-pull-through-cache-config
    namespace: ci
  data:
    config.yaml: |
      version: 0.1
      log:
        fields:
          service: registry
      storage:
        cache:
          blobdescriptor: inmemory
        filesystem:
          rootdirectory: /var/lib/registry
      http:
        addr: :5000
        headers:
          X-Content-Type-Options: [nosniff]
      health:
        storagedriver:
          enabled: true
          interval: 10s
          threshold: 3
      htpasswd:
        realm: basic-realm
        path: /etc/htpasswd
      proxy:
        remoteurl: https://quay.io
      s3:
        encrypt: true
- apiVersion: v1
  kind: ConfigMap
  metadata:
    name: quayio-pull-through-cache-exec
    namespace: ci
  data:
    start.sh: |
      apk add --no-cache apache2-utils
      htpasswd -Bbn ${REGISTRY_PROXY_USERNAME} ${REGISTRY_PROXY_PASSWORD} > /etc/htpasswd
      /entrypoint.sh /etc/docker/registry/config.yml
